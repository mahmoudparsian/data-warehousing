# üìä Slowly Changing Dimensions (SCD)

## A Complete Teaching Module for Data Warehousing Students

------------------------------------------------------------------------

# 1Ô∏è‚É£ What is a Dimension in Data Warehousing?

In a **Star Schema**, we typically have:

-   **Fact Tables** ‚Üí store measurable events (sales, trades, orders,
    clicks)
-   **Dimension Tables** ‚Üí store descriptive attributes (customer,
    product, employee, location)

Example:

`Fact_Sales`: 

- `sale_id` 
- `customer_id` 
- `product_id` 
- `date_id` 
- `amount`

`Dim_Customer`: 

- `customer_id` 
- `name` 
- `address` 
- `city` 
- `state` 
- `loyalty_status`

------------------------------------------------------------------------

# 2Ô∏è‚É£ The Problem: Data Changes Over Time

In real systems:

-   Customers move to new addresses
-   Products change categories
-   Employees get promoted
-   Suppliers change regions

**Question:**

* Should we overwrite the old value?
* Should we keep history?
* Should we keep partial history?

üëâ This is where **Slowly Changing Dimensions (SCD)** come in.

------------------------------------------------------------------------

# 3Ô∏è‚É£ Definition: Slowly Changing Dimension (SCD)

A **Slowly Changing Dimension** is a dimension that changes over time,
but not very frequently.

SCD techniques define:

-   How to store historical changes
-   When to overwrite data
-   When to create new rows
-   How to track effective dates

------------------------------------------------------------------------

# 4Ô∏è‚É£ SCD Types Overview

  ------------------------------------------------------------------------
  Type      Description          Keeps History?           Use Case
  --------- -------------------- ------------------------ ----------------
  Type 0    Fixed -- No changes  ‚ùå                       Immutable data
            allowed                                       

  Type 1    Overwrite old data   ‚ùå                       Correcting
                                                          errors

  Type 2    Add new row with     ‚úÖ Full history          Address changes
            history                                       

  Type 3    Add new column for   ‚ö† Limited                Track previous
            old value                                     value

  Type 4    History table        ‚úÖ Full (separate table) Large history

  Type 6    Hybrid (1+2+3)       ‚úÖ                       Advanced
                                                          analytics
  ------------------------------------------------------------------------

------------------------------------------------------------------------

# 5Ô∏è‚É£ SCD Type 0 --- Fixed Dimension

## Definition:

Data never changes after insert.

Example: Dim_Date table (date, year, quarter).

When to Use: - Date dimension - Country codes - Historical immutable
attributes

------------------------------------------------------------------------

# 6Ô∏è‚É£ SCD Type 1 --- Overwrite

## Definition:

When data changes, overwrite the old value.

Example:

Before: customer_id \| name \| city 1 \| Alice \| San Jose

Customer moves to San Francisco.

After: 1 \| Alice \| San Francisco

History is lost.

When to Use: - Fixing typos - Non-analytical attributes - Data
correction

SQL Example:

``` sql
UPDATE dim_customer
SET city = 'San Francisco'
WHERE customer_id = 1;
```

------------------------------------------------------------------------

# 7Ô∏è‚É£ SCD Type 2 --- Full History (Most Important)

## Definition:

Insert a new row for every change. Keep effective dates.

Example:

Before:

| customer_sk | customer_id | city           | start_date | end_date     | current_flag |
|------------:|------------:|----------------|------------|--------------|--------------|
| 1           | 1           | San Jose       | 2022-01-01 | 2024-01-31   | N            |
| 2           | 1           | San Francisco  | 2024-02-01 | NULL         | Y            |

Key Concepts: 

- Surrogate key (customer_sk) 
- Effective start and end dates 
- Current flag

When to Use: 

- Address changes 
- Loyalty tier changes 
- Employment changes 
- Regulatory requirements

ETL Logic:

1.  Detect change
2.  Expire old row (set end_date)
3.  Insert new row

------------------------------------------------------------------------

# 8Ô∏è‚É£ Realistic Example --- Banking Customer Address Change

Business Requirement: We must know where the customer lived at the time
of a transaction.

`Fact_Transactions:` 

- `transaction_id`
- `customer_sk` 
- `date_id` 
- `amount`

Why Type 2? Because if we overwrite address (Type 1), historical reports
become incorrect.

------------------------------------------------------------------------

# 9Ô∏è‚É£ SCD Type 3 --- Limited History

## Definition:

Add a new column to track previous value.

Example:

```
customer_id | city_current  | city_previous
1           | San Francisco | San Jose
```

Only tracks one previous change.

When to Use: 

- When only one previous value matters 
- Small history requirements

Limitation: Cannot track multiple historical changes.

------------------------------------------------------------------------

# üîü SCD Type 4 --- History Table

Two tables:

* `Dim_Customer_Current` 
* `Dim_Customer_History`

* Current table stores active records. 
* History table stores all previous versions.

When to Use: 

- Very large dimension 
- Separate operational and analytical needs

------------------------------------------------------------------------

# 1Ô∏è‚É£1Ô∏è‚É£ SCD Type 6 --- Hybrid

Combines Type 1 + Type 2 + Type 3.

Includes: 

- Historical rows (Type 2) 
- Current overwrite (Type 1) 
- Previous value column (Type 3)

Used in: 

- Advanced BI systems 
- High analytical complexity

------------------------------------------------------------------------

# 1Ô∏è‚É£2Ô∏è‚É£ When to Use Which Type?

| Scenario                               | Recommended Type |
|----------------------------------------|------------------|
| Correct typo                           | Type 1           |
| Track customer address history         | Type 2           |
| Track only previous manager            | Type 3           |
| Immutable data                         | Type 0           |
| Large-scale historical auditing        | Type 4           |
| Advanced reporting with hybrid needs   | Type 6           |

------------------------------------------------------------------------

# 1Ô∏è‚É£3Ô∏è‚É£ Complete Teaching Example

Scenario: E-commerce System

Customer changes: 

- Address 
- Loyalty Tier

Recommended Strategy:

* Address ‚Üí Type 2
* Loyalty Tier ‚Üí Type 2
* Email typo ‚Üí Type 1

Why? Address affects geographic sales analysis. Loyalty affects revenue
segmentation.

------------------------------------------------------------------------

# 1Ô∏è‚É£4Ô∏è‚É£ Common Interview Question

Why do we use surrogate keys in SCD Type 2?

Answer: Because natural keys remain the same, but each version needs a unique identifier.

------------------------------------------------------------------------

# 1Ô∏è‚É£5Ô∏è‚É£ Final Summary

SCD is about managing change in dimension tables.

Most important type in real data warehousing: ‚≠ê Type 2

Why? Because historical accuracy matters in analytics.

------------------------------------------------------------------------

# üéì Teaching Recommendation

1.  Start with Type 1 example (simple)
2.  Move to Type 2 with timeline diagram
3.  Show ETL SQL
4.  Connect to real business case
5.  Compare reports with and without history

------------------------------------------------------------------------

End of Module
